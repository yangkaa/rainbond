name: Build Region

on:
  workflow_call:
    inputs:
      branch:
        required: true
        type: string
      clone_url:
        required: true
        type: string
      repo:
        required: true
        type: string
      environment:
        required: true
        type: string
      rbdcomponent:
        required: true
        type: string
#        options:
#          - api
#          - chaos
#          - gateway
#          - monitor
#          - mq
#          - webcli
#          - worker
#          - eventlog
#          - init-probe
#          - mesh-data-panel
#          - grctl
#          - node
#          - resource-proxy
#          - shell
      version:
        required: true
        type: string

env:
  IMAGE_NAMESPACE: ${{ vars.IMAGE_NAMESPACE }}
  DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
  DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}

  DOMESTIC_BASE_NAME: ${{ vars.DOMESTIC_BASE_NAME }}
  DOMESTIC_NAMESPACE: ${{ vars.DOMESTIC_NAMESPACE }}
  DOMESTIC_DOCKER_USERNAME: ${{ secrets.DOMESTIC_DOCKER_USERNAME }}
  DOMESTIC_DOCKER_PASSWORD: ${{ secrets.DOMESTIC_DOCKER_PASSWORD }}

  VERSION: ${{ inputs.version }}

jobs:
  build-item:
    runs-on: ubuntu-22.04
    environment: ${{ inputs.environment }}
    steps:
      - name: Setup Go environment
        uses: actions/setup-go@v2.1.3
        with:
          # The Go version to download (if necessary) and use. Supports semver spec and ranges.
          go-version: 1.18
      - name: "Pull code and Build the Docker image"
        env:
          DISABLE_GOPROXY: true
        run: |
          git clone -b ${{ inputs.branch }} ${{ inputs.clone_url }}/${{ inputs.repo }}.git
          cd ${{ inputs.repo }}
          chmod +x ./release.sh
          ./release.sh
#          if ${{ inputs.repository == "rainbond-operator" }}; then

#          else
#            ./release.sh ${{ inputs.rbdcomponent }} push
#          fi
